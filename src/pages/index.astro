---
import Layout from '../layouts/Layout.astro';
import Navbar from "../components/navigationBar/Navbar.astro";
import Card from '../components/Card.astro';
import CardWithInput from '../components/CardWithInput.astro';

// Importing database tools.
import { app } from "../firebase/server";
import { getAuth } from "firebase-admin/auth";
import { getFirestore } from 'firebase-admin/firestore';

// Initalizing the method that will allow us to get the user.
const auth = getAuth(app);

// Importing user interface
import type { userModel } from '../pages/api/interfaces/user';

// Check current session 
if (!Astro.cookies.has("session")) {
  return Astro.redirect("/signin");
}
const sessionCookie = Astro.cookies.get("session").value;
const decodedCookie = await auth.verifySessionCookie(sessionCookie);
const user = await auth.getUser(decodedCookie.uid);

if (!user) {
  return Astro.redirect("/signin");
}

const db = getFirestore(app);
const usersRef = db.collection("users");
const userSnapshot = await usersRef.doc(user.uid).get();

if (!userSnapshot.exists) {
  return Astro.redirect("/404");
}
const currentUser = userSnapshot.data() as userModel;

import '../styles.css';
---

<Layout title="¿Como Se Dice?">
	<!-- Navigation bar -->
	<Navbar 
    username={ currentUser.username }, 
    email={ currentUser.email }, 
    userImage='/src/pages/images/mario.png'
    />

	<!-- Card elements. -->
	<main class="snap-center bg-white border-gray-200 dark:bg-gray-900">
	    <svg>
			<defs>
				<linearGradient
					id="paint0_linear_1805_24383"
					x1="247.358"
					y1="0"
					x2="247.358"
					y2="622.479"
					gradientUnits="userSpaceOnUse"
					<stop stop-opacity="0.9"></stop>
					<stop offset="1" stop-opacity="0.2"></stop>
				>
			</defs>
		</svg>

		<ul role="list" class="link-card-grid drop-shadow-xl">
			<Card
				href="/singleplayer"
				title="Start Singleplayer"
				body="Play Como Se Dice Alone"
				
			/>
			<Card
				href="/multiplayer"
				title="Start Multiplayer Room"
				body="Start a room to play against friends 😈"
			/> 
			<Card
				href="daily"
				title="Start Daily Challenge"
				body="Get as many words right in the shortest time and see where you stack up against the world 🌐"
			/>
			<CardWithInput
				title="Join Multiplayer Room"
				roomCode="0000"

			/>
		</ul>
	</main>
</Layout>
